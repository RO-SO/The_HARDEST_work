<html>
<head>

<script src="/bower_components/angular/angular.min.js"></script>
<script src="/bower_components/angular-route/angular-route.js"></script>
<script src="/bower_components/angular-local-storage.js"></script>

<script type="text/javascript">
	var app = angular
		.module("Example",['ngRoute', 'LocalStorageModule'])
			.config(function($routeProvider){
        		$routeProvider
	            .when("/CreateRoom", {
	                templateUrl : "views/CreateRoom.html",
	                controller : "createRoomController"
	            })
                .when("/CreateVisitor", {
                    templateUrl : "views/CreateVisitor.html",
                    controller : "CreateVisitorController"
                })
                
                .when("/room", {
                    templateUrl : "views/room.html",
                    controller : "roomController"
                })
    		})
    		.config(function (localStorageServiceProvider) {
    			localStorageServiceProvider
    				.setPrefix('Test')
    				.setStorageType('sessionStorage')
    				.setNotify(true, true)
    		})
    		.controller("mainController", function($scope, $location, localStorageService) {
                $scope.roomInfo;
                // $scope.user;
    			$scope.goTo = function(url) 
    			{
    				$location.path(url);
    			}
                $scope.goToRoom = function(url, room) 
                {
                    $location.path(url);
                    $scope.roomInfo = room;
                }
                if (localStorageService.get("message") != null) 
                {
                    $scope.rooms = localStorageService.get("message");
                } 

                else
                {
                    $scope.rooms = [];
                    localStorageService.set("message", $scope.rooms)
                }


                // $scope.Time = function (student){
                // for (var i = 0; i < $scope.groups.length; i++) {
                //     if ($scope.groups[i]==student.group) 
                //     {
                //          function ChangeStyleRed() 
                //         { 
                //             document.getElementById("p1").style.color="red"; 
                //         }
                //         setTimeout(ChangeStyleRed(), student.time * 1000);
                //     }
                // }}
                
    		})

            .controller("createRoomController", function($scope, localStorageService) {
               
                var rooms = localStorageService.get("message");

                function RoomClass(name, code, visitor)
                {
                    this.name = name;
                    this.code = code;
                    this.visitor = visitor;
                                       
                }
           
                $scope.CreateRoom = function() {
                    var room = new RoomClass($scope.room.name, $scope.room.code, "");
                    rooms.push(room);
                    localStorageService.set("message", rooms);
                    
                }

               
                // function ChangeStyleYellow() 
                // { 
                //     document.getElementById("p1").style.color="yellow"; 
                // }
                // function ChangeStyleGreen() 
                // { 
                //     document.getElementById("p1").style.color="green"; 
                // }
                
                
            })
            
                // $scope.Time = function (student){
                // for (var i = 0; i < $scope.groups.length; i++) {
                //     if ($scope.groups[i]==student.group) 
                //     {
                //          function ChangeStyleRed() 
                //         { 
                //             document.getElementById("p1").style.color="red"; 
                //         }
                //         setTimeout(ChangeStyleRed(), student.time * 1000);
                //     }
                // }}
                
            .controller("CreateVisitorController", function($scope, localStorageService) {
                
                var room;
                var rooms = localStorageService.get("message");
                function VisitorClass(name, surname, time)
                {
                    this.name = name;
                    this.surname = surname;
                    this.time = time;
                }

                $scope.pickRoom = function(pRoom) {
                    room = pRoom;
                    console.log(room);
                }
                $scope.CreateVisitor = function() {
                    var visitor = new VisitorClass($scope.visitor.name, $scope.visitor.surname);
                    for (var i = 0; i < rooms.length; i++) {
                        if (rooms[i].name == room.name) {
                            room.visitor = visitor;
                            rooms[i] = room;
                            localStorageService.set("message", rooms);
                            
                        }
                    }
                }
            })

            
                

            .controller("roomController", function($scope) {
               
                
                $scope.visitor = $scope.roomInfo.visitor;

                $scope.deleteVisitor = function (visitor) {
                    
                            delete $scope.roomInfo.visitor;
                            console.log($scope.roomInfo.visitor);
                            for (var i = 0; i < rooms.length; i++) {
                                if (rooms[i].name == $scope.roomInfo.name) {
                                    rooms[i] = $scope.roomInfo;
                                    localStorageService.set("message", rooms);
                                }
                            }
                        }
                   
                
            })
</script>

<link rel="stylesheet" type="text/css" href="main.css">
</head>
<body  background=sea.jpg  ng-app="Example">
    <div class="main">
    	<div ng-controller="mainController">
            <button class="knopka" ng-click="goTo('')">Главная</button>
            <button class="knopka" ng-click="goTo('/CreateRoom')">Добавить номер</button>
            <button class="knopka" ng-click="goTo('/CreateVisitor')">Добавить поситителя</button>
            
            <h3>Список номеров:</h3>
    		<div ng-repeat="room in rooms" ng-click="goToRoom('/room', room)">{{room.name}}</div>
            <!-- <button class="knopka" ng-click="deleteSub">Удалить предмет</button> -->
            
    		<div ng-view>

    		</div>
    	</div>
    </div>
</body>
</html>